/* MIT License - Copyright (c) Microsoft Corporation. */


((e,v)=>{var r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}))(e,t)},a=function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},G=(t.merge=function(e,t){for(var r=window||global,n=0,o=e.split(".");n<o.length;n++){var i=o[n];if(!r[i])return t;r=r[i]}return a(a({},r),t)},t);function t(){}n.parse=function(e){if(!Array.isArray(e))return new u.literal(e);if(0<e.length){var t=u[e[0]];if(t)return t.parse(e)}throw"Invalid expression"};var y=n;function n(){}i.parse=function(e){if(3<=e.length)return new i(e[0],y.parse(e[1]),y.parse(e[2]));throw"Invalid '".concat(e[1],"' expression.")},i.prototype.eval=function(e){var t=this,r=t._e1.eval(e),n=t._e2.eval(e);switch(t._c){case"<":return r<n;case"<=":return r<=n;case"==":return r==n;case"!=":return r!=n;case">":return n<r;case">=":return n<=r;case">":return n<r}throw"Invalid comparison"};var o=i;function i(e,t,r){var n=this;n._c=e,n._e1=t,n._e2=r}l.parse=function(e){if(3<=e.length){for(var t=[],r=1,n=e.length;r<n;r++)Array.isArray(e[1])?t.push(y.parse(e[r])):t.push(e[r]);return new l(e[0],t)}throw"Invalid '".concat(e[0],"' expression.")},l.prototype.eval=function(e){var t=this,r=Math,n=1<=t._e.length?t._getValue(e,t._e[0]):0,o=2<=t._e.length?t._getValue(e,t._e[1]):0;switch(t._o){case"+":case"*":case"min":case"max":t._evalArray(e);break;case"-":return o-n;case"/":return n/o;case"%":return n%o;case"^":return r.pow(n,o);case"abs":return r.abs(n);case"acos":return r.acos(n);case"asin":return r.asin(n);case"atan":return r.atan(n);case"ceil":return r.ceil(n);case"cos":return r.cos(n);case"e":return r.exp(n);case"floor":return r.floor(n);case"ln":return r.log(n);case"ln2":return r.LN2;case"log10":return r.log(n)/r.LN10;case"log2":return r.log(n)/r.LN2;case"pi":return r.PI;case"round":return r.round(n);case"sin":return r.sin(n);case"sqrt":return r.sqrt(n);case"tan":return r.tan(n)}throw"Invalid '".concat(t._o,"' expression.")},l.prototype._evalArray=function(r){var e,n=this,t=0;switch(n._o){case"+":e=function(e,t){return e+n._getValue(r,t)};break;case"*":t=1,e=function(e,t){return e*n._getValue(r,t)};break;case"max":t=n._getValue(r,n._e[0]),e=function(e,t){return Math.max(e,n._getValue(r,t))};break;case"min":t=n._getValue(r,n._e[0]),e=function(e,t){return Math.min(e,n._getValue(r,t))}}return n._e.reduce(e,t)},l.prototype._getValue=function(e,t){return"number"==typeof t?t:t.eval(e)};var s=l;function l(e,t){this._o=e,this._e=t}c.parse=function(e){if(3<=e.length)return new c(e[0],y.parse(e[2]),e[1]);if(2===e.length)return new c(e[0],y.parse(e[1]));throw"Invalid 'CellAggregateExpression'."},c.prototype.eval=function(e){return this._e.eval(e)},c.prototype.finalize=function(e,t){if(e.aggregateProperties){var r=e.aggregateProperties[t],n=this._i;if(void 0!==n)switch(this._o){case"max":r=Math.max(n,r);break;case"min":r=Math.min(n,r);break;case"+":r=n+r;break;case"*":r*=n;break;case"all":r=n&&r;break;case"any":r=n||r}e.aggregateProperties[t]=r}};var j=c;function c(e,t,r){this._o=e,this._e=t,this._i=r}var u={get:(T.parse=function(e){var t=3<=e.length?y.parse(e[2]):void 0;if(2<=e.length)return new T(e[1],t);throw"Invalid 'get' expression."},T.prototype.eval=function(e){var t=e;return(t=this._e?this._e.eval(e):t)[this._n]},T),has:(z.parse=function(e){var t=3<=e.length?y.parse(e[2]):void 0;if(2<=e.length)return new z(e[1],t);throw"Invalid 'has' expression."},z.prototype.eval=function(e){var t=e;return this._e&&(t=this._e.eval(e)[this._n]),-1<Object.keys(t).indexOf(this._n)},z),literal:(O.parse=function(e){if(2<=e.length)return new O(e[1]);throw"Invalid 'literal' expression."},O.prototype.eval=function(e){return this._v},O),at:(k.parse=function(e){if(3<=e.length)return new k(e[1],y.parse(e[2]));throw"Invalid 'at' expression."},k.prototype.eval=function(e){return this._e.eval(e)[this._i]},k),"index-of":(I.parse=function(e){var t=0;if(4<=e.length&&(t=e[3]),3<=e.length)return new I(e[1],y.parse(e[2]),t);throw"Invalid 'index-of' expression."},I.prototype.eval=function(e){return this._e.eval(e).indexOf(this._v,this._i)},I),length:(M.parse=function(e){if(3<=e.length)return new M(y.parse(e[1]));throw"Invalid 'length' expression."},M.prototype.eval=function(e){return this._e.eval(e).length},M),slice:(P.parse=function(e){var t;if(4<=e.length&&(t=e[3]),3<=e.length)return new P(y.parse(e[1]),e[2],t);throw"Invalid 'index-of' expression."},P.prototype.eval=function(e){return this._v.eval(e).slice(this._s,this._e)},P),"!":(C.parse=function(e){if(2<=e.length)return new C(y.parse(e[1]));throw"Invalid '!' expression."},C.prototype.eval=function(e){return!this._e.eval(e)},C),"!=":o,"<":o,"<=":o,"==":o,">":o,">=":o,"to-boolean":(w.parse=function(e){if(2<=e.length)return new w(y.parse(e[1]));throw"Invalid 'to-boolean' expression."},w.prototype.eval=function(e){e=this._e.eval(e);return"boolean"==typeof e?e:"string"==typeof e?-1<["true","yes","on","1"].indexOf(e.toLowerCase()):"number"==typeof e&&1===e},w),"to-number":(b.parse=function(e){if(2<=e.length)return new b(y.parse(e[1]));throw"Invalid 'to-number' expression."},b.prototype.eval=function(e){e=this._e.eval(e);return"boolean"==typeof e?e?1:0:"string"==typeof e?Number.parseFloat(e):"number"==typeof e?e:Number.NaN},b),"to-string":(x.parse=function(e){if(2<=e.length)return new x(y.parse(e[1]));throw"Invalid 'to-number' expression."},x.prototype.eval=function(e){e=this._e.eval(e);return e.toString?e.toString():Number.NaN},x),typeof:(m.parse=function(e){if(2<=e.length)return new m(y.parse(e[1]));throw"Invalid 'typeOf' expression."},m.prototype.eval=function(e){return typeof this._e.eval(e)},m),case:(d.parse=function(e){if(3<=e.length&&e.length%2==0){for(var t=[],r=[],n=1,o=e.length;n<o;n+=2)t.push(y.parse(e[n])),r.push(e[n+1]);return new d(t,r,e[e.length-1])}throw"Invalid 'case' expression."},d.prototype.eval=function(e){for(var t=0,r=this._e.length;t<r;t++)if(this._e[t].eval(e))return this._o[t];return this._f},d),match:(_.parse=function(e){if(5<=e.length&&e.length%2==1){for(var t=y.parse(e[1]),r=[],n=[],o=2,i=e.length-1;o<i;o+=2)r.push(e[o]),n.push(e[o+1]);return new _(t,r,n,e[e.length-1])}throw"Invalid 'match' expression."},_.prototype.eval=function(e){for(var t=this,r=t._i.eval(e),n=0,o=t._l.length;n<o;n++)if(t._l[n]===r)return t._o[n];return t._f},_),step:(g.parse=function(e){if(5<=e.length&&e.length%2==1){var t=y.parse(e[1]),r=[],n=[];n.push(e[2]);for(var o=3,i=e.length;o<i;o+=2)r.push(e[o]),n.push(e[o+1]);return new g(t,r,n)}throw"Invalid 'step' expression."},g.prototype.eval=function(e){for(var t=this,r=t._i.eval(e),n=0,o=t._l.length;n<o;n++)if(r<=t._l[n])return t._o[n];return t._o[t._o.length-1]},g),in:(f.parse=function(e){if(3<=e.length)return new f(e[1],y.parse(e[2]));throw"Invalid 'at' expression."},f.prototype.eval=function(e){return-1<this._e.eval(e).indexOf(this._i)},f),all:(h.parse=function(e){if(3<=e.length&&e.length%2==0){for(var t=[],r=1,n=e.length;r<n;r++)t.push(y.parse(e[r]));return new h(t)}throw"Invalid 'all' expression."},h.prototype.eval=function(t){var r=!0;return this._e.forEach(function(e){r=r&&e.eval(t)}),r},h),any:(p.parse=function(e){if(3<=e.length&&e.length%2==0){for(var t=[],r=1,n=e.length;r<n;r++)t.push(y.parse(e[r]));return new p(t)}throw"Invalid 'any' expression."},p.prototype.eval=function(t){var r=!1;return this._e.forEach(function(e){r=r||e.eval(t)}),r},p),"+":s,"*":s,min:s,max:s,"-":s,"/":s,"%":s,"^":s,abs:s,acos:s,asin:s,atan:s,ceil:s,cos:s,e:s,floor:s,ln:s,ln2:s,log10:s,log2:s,pi:s,round:s,sin:s,sqrt:s,tan:s};function p(e){this._e=e}function h(e){this._e=e}function f(e,t){this._i=e,this._e=t}function g(e,t,r){this._i=e,this._l=t,this._o=r}function _(e,t,r,n){this._i=e,this._l=t,this._o=r,this._f=n}function d(e,t,r){this._e=e,this._o=t,this._f=r}function m(e){this._e=e}function x(e){this._e=e}function b(e){this._e=e}function w(e){this._e=e}function C(e){this._e=e}function P(e,t,r){this._v=e,this._s=t,this._e=r}function M(e){this._e=e}function I(e,t,r){this._v=e,this._e=t,this._i=r}function k(e,t){this._i=e,this._e=t}function O(e){this._v=e}function z(e,t){this._n=e,this._e=t}function T(e,t){this._n=e,this._e=t}S.calculateGrid=function(e,t,r){var n,o=this,i=(r=Object.assign({gridType:"hexagon",cellWidth:25e3,distanceUnits:"meters",coverage:1,minCellWidth:0,scaleExpression:o.LinearPointCountScaleExpression},r||{}),e=e||[],o._getGroundResolutionZ22(r.centerLatitude)),a=v.math.convertDistance(r.cellWidth,r.distanceUnits,"meters")/i,i=v.math.convertDistance(Math.min(r.minCellWidth,r.cellWidth),r.distanceUnits,"meters")/i,s=r.aggregateProperties&&0<Object.keys(r.aggregateProperties).length,l=s?o._parseMapExpressions(r.aggregateProperties):{},c=y.parse(r.scaleExpression||o.LinearPointCountScaleExpression),u=o._getArcAngles(r.gridType),p=Math.sqrt(3);switch(r.gridType){case"pointyHexagon":n=2*a/p;break;case"hexagon":case"hexCircle":n=p*a*.5;break;case"triangle":n=.5*p*a;break;default:n=a}for(var h={cells:[],cellLookupTable:{},pointLookupTable:{},width:a,height:n},f={col:0,row:0,z:0},g=0,_=e.length;g<_;g++){var d=t[g],d=(o._getCellCoord(d,a,n,r.gridType,f,p),"x".concat(f.col,"y").concat(f.row,"z").concat(f.z)),d=o._getGridCell(d,f,g,h,a,n,r.gridType,s);o._incrementCellInfo(d.properties,e[g],r.aggregateProperties,l)}return o._finalizeGrid(h,a,n,r,l,c,i,u),h},S.recalculateCoords=function(e,t){for(var r=y.parse(t.scaleExpression||this.LinearPointCountScaleExpression),n=v.math.convertDistance(Math.min(t.minCellWidth,t.cellWidth),t.distanceUnits,"meters")/this._getGroundResolutionZ22(t.centerLatitude),o=0,i=e.cells.length;o<i;o++)e.cells[o].geometry.coordinates=this.createGridPolygon(e.cells[o].properties,t,e.width,e.height,this._getArcAngles(t.gridType),n,r,e.scaleMetrics)},S.toPixel22=function(e){var t=Math.sin(e[1]*this.PI_By_180),r=this.MapSize22;return[(e[0]+180)/360*r,(.5-Math.log((1+t)/(1-t))/(4*Math.PI))*r]},S._getCellCoord=function(e,t,r,n,o,i){switch(n){case"pointyHexagon":this._rotatedHexCellCoord(e,t,r,o,i);break;case"hexagon":case"hexCircle":this._hexCellCoord(e,t,r,o,i);break;case"triangle":this._triangleCellCoord(e,t,r,o,i);break;default:o.col=Math.floor(e[0]/t),o.row=Math.floor(e[1]/r)}},S._getGroundResolutionZ22=function(e){return 2*Math.cos(e*this.PI_By_180)*Math.PI*6378137/this.MapSize22},S._getGridCell=function(e,t,r,n,o,i,a,s){var l=n.cellLookupTable[e];return void 0!==l?(n.pointLookupTable[e].push(r),n.cells[l]):(l=this._createCellFromCubeCoord(e,t,a,o,i,s),n.pointLookupTable[e]=[r],n.cells.push(l),n.cellLookupTable[e]=n.cells.length-1,l)},S._hexCellCoord=function(e,t,r,n,o){n.col=4*e[0]/(3*t),n.z=(e[1]-e[0]/o)/r,n.row=-n.col-n.z,S._roundCubeCoord(n)},S._rotatedHexCellCoord=function(e,t,r,n,o){return n.col=(e[0]-e[1]/o)/t,n.z=4*e[1]/(3*r),n.row=-n.col-n.z,S._roundCubeCoord(n)},S._roundCubeCoord=function(e){var t=Math.round,r=Math.abs,n=t(e.col),o=t(e.row),t=t(e.z),i=r(n-e.col),a=r(o-e.row),r=r(t-e.z);a<i&&r<i?n=-o-t:r<a?o=-n-t:t=-n-o,e.col=n,e.row=o,e.z=t},S._triangleCellCoord=function(e,t,r,n,o){n.row=Math.floor(e[1]/r),n.col=Math.floor(e[0]/t);var i=(n.row+1)*r-e[1],e=e[0]-n.col*t;1<(i=n.row%2==1?r-i:i)&&(e<.5*t?e/i<1/o&&(n.col-=.5):(t-e)/i<1/o&&(n.col+=.5))},S._createCellFromCubeCoord=function(e,t,r,n,o,i){switch(r){case"pointyHexagon":s=n*(t.col+.5*t.z),a=.75*o*t.z;break;case"hexagon":case"hexCircle":s=.75*n*t.col,a=o*(t.z+.5*t.col);break;case"triangle":var a=Math.floor(t.row*o),s=Math.floor((t.col+.5)*n),l=Math.abs(t.col-Math.round(t.col))<.1,c=Math.round(t.row)%2==0?l:!l;break;default:s=(t.col+.5)*n,a=(t.row+.5)*o}return this._createCell(e,s,a,c,i)},S._getArcAngles=function(e){var t=S,r=t._calculateArcAngles,n=t._arcAngles[e];if(!n){switch(e){case"circle":case"hexCircle":n=r(36);break;case"pointyHexagon":n=r(6);break;case"hexagon":n=r(6,30)}t._arcAngles[e]=n}return n},S._calculateArcAngles=function(e,t){t=t||0;for(var r,n=360/e,o=[],i=[],a=0;a<e;a++)r=(a*n+t)*S.PI_By_180,o.push(Math.sin(r)),i.push(Math.cos(r));return{sin:o,cos:i}},S._toPosition22=function(e){var t=S.MapSize22,r=Math;return[360*(e[0]/t-.5),90-360*r.atan(r.exp((e[1]/t-.5)*r.PI*2))/r.PI]},S._parseMapExpressions=function(r){var e,n={};return r&&Object.keys(r).forEach(function(t){if((e=r[t])&&2<=e.length)try{n[t]=j.parse(e)}catch(e){r[t]=void 0}else r[t]=void 0}),n},S._incrementCellInfo=function(n,o,i,a){var s,l,c,u;n.point_count++,i&&(s=n.point_count,u=n.aggregateProperties||{},Object.keys(i).forEach(function(e){var t=i[e],r=a[e];if(r){if(c=r.eval(o.properties),null!==(l=1===s?Array.isArray(t[1])?null:t[1]:u[e]))switch(t[0]){case"max":c=c<l?l:c;break;case"min":c=l<c?l:c;break;case"+":c=l+c;break;case"*":c*=l;break;case"all":c=l&&c;break;case"any":c=l||c}null!==c&&(u[e]=c)}n.aggregateProperties=u}))},S._finalizeCellInfo=function(t,r,e,n){var o=t.point_count,i=o.toString(),i=(1e6<=o?i="".concat(Math.round(o/1e6),"M"):1e3<=o&&(i="".concat(Math.round(o/1e3),"k")),t.point_count_abbreviated=i,o);r&&(Object.keys(r).forEach(function(e){r[e].finalize(t,e)}),n)&&void 0!==t.aggregateProperties[n]&&(i=t.aggregateProperties[n]),e&&(void 0===e.min?(e.min=i,e.max=i):(e.min=Math.min(e.min,i),e.max=Math.max(e.max,i)))},S._createCell=function(e,t,r,n,o){return{type:"Feature",properties:{cell_id:e,aggregateProperties:o?{}:void 0,_x:t,_y:r,_rightSideUp:n,point_count:0,point_count_abbreviated:"0"},geometry:{type:"Polygon",coordinates:[]}}},S.createGridPolygon=function(e,t,r,n,o,i,a,s){var l=S,c=t.coverage||1,u=(t.scaleProperty&&s&&(a=a.eval(Object.assign({min:s.min,max:s.max},e)),isNaN(a)||"number"!=typeof a||(c*=a)),l._getRegularPolygon);switch(t.gridType){case"square":return l._getSquare(e,r,c,i);case"hexCircle":return u(e,l.InnerRadiusScale*r*.5*c,o,i);case"triangle":return l._getTriangle(e,r,n,c,i);case"pointyHexagon":return u(e,.5*n*c,o,i);default:return u(e,.5*r*c,o,i)}},S._getRegularPolygon=function(r,n,o,e){var i,a,s=S,l=[],c=s.MapSize22;return 2*n<e&&(n=.5*e),o.sin.forEach(function(e,t){i=Math.min(Math.max(r._x+n*e,0),c),a=r._y+n*o.cos[t],l.push(s._toPosition22([i,a]))}),l.push(l[0]),[l]},S._getSquare=function(e,t,r,n){var t=.5*Math.max(t*r,n),r=e._y-t,n=e._y+t,o=Math.max(e._x-t,0),e=Math.min(e._x+t,this.MapSize22),t=this._toPosition22,o=[t([o,r]),t([o,n]),t([e,n]),t([e,r])];return o.push(o[0]),[o]},S._getTriangle=function(e,t,r,n,o){var i=e._x,a=e._y+.5*(r-r*n),n=(r*=n,(t*=n)<o&&(r*=o/t),.5*t),o=this.MapSize22,t=i,s=i+n,i=i-n,n=Math.max,l=Math.min,n=(i<0?(t=n(t,0),s=n(s,0),i=n(i,0)):o<s&&(t=l(t,o),s=l(s,o),i=l(i,o)),this._toPosition22),l=e._rightSideUp?[n([t,a]),n([s,r+a]),n([i,r+a])]:[n([t,r+a]),n([s,a]),n([i,a])];return l.push(l[0]),[l]},S._finalizeGrid=function(e,t,r,n,o,i,a,s){var l={},c=e.cells.length;if(n.scaleProperty){for(var u=0;u<c;u++)this._finalizeCellInfo(e.cells[u].properties,o,l,n.scaleProperty);for(u=0;u<c;u++)e.cells[u].geometry.coordinates=this.createGridPolygon(e.cells[u].properties,n,t,r,s,a,i,l)}else for(u=0;u<c;u++)this._finalizeCellInfo(e.cells[u].properties,o,l,n.scaleProperty),e.cells[u].geometry.coordinates=this.createGridPolygon(e.cells[u].properties,n,t,r,s,a,i,l);e.scaleMetrics=l},S.PI_By_180=Math.PI/180,S.MapSize22=512*Math.pow(2,22),S.InnerRadiusScale=Math.cos(30*Math.PI/180),S.LinearPointCountScaleExpression=["/",["-",["get","point_count"],["get","min"]],["-",["get","max"],["get","min"]]],S._arcAngles={};var A=S;function S(){}L=v.source.DataSource,r(E=W,o=L),E.prototype=null===o?Object.create(o):(N.prototype=o.prototype,new N),W.prototype.add=function(e){this._addPoints(e),this._recalculate()},W.prototype.clear=function(){this._points=[],this._pixels=[],L.prototype.clear.call(this)},W.prototype.dispose=function(){var t=this;this.clear(),L.prototype.dispose.call(this),Object.keys(this).forEach(function(e){return t[e]=null})},W.prototype.getCellChildren=function(e){var t=this._gridInfo.pointLookupTable[e],r=[];if(t)for(var n=0,o=t.length;n<o;n++)r.push(this._points[t[n]]);return JSON.parse(JSON.stringify(r))},W.prototype.getGridCells=function(){return L.prototype.toJson.call(this)},W.prototype.getOptions=function(){return Object.assign({},this._options)},W.prototype.getPoints=function(){return new v.data.FeatureCollection(JSON.parse(JSON.stringify(this._points)))},W.prototype.importDataFromUrl=function(r){var n=this,o=this;return new Promise(function(e,t){L.prototype.clear.call(n),L.prototype.importDataFromUrl.call(n,r).then(function(){o._addPoints(L.prototype.toJson.call(n)),o._recalculate(),e()},function(){t()})})},W.prototype.remove=function(e){this._remove(e),this._recalculate()},W.prototype.removeById=function(e){this._remove(e),this._recalculate()},W.prototype.setOptions=function(e){var t,r,n,o,i,a;e&&(t=this._options,o=n=!(r={}),"number"==typeof e.maxZoom&&0<=e.maxZoom&&e.maxZoom<25&&e.maxZoom!==t.maxZoom&&(t.maxZoom=e.maxZoom,r.maxZoom=e.maxZoom),"number"==typeof e.cellWidth&&0<e.cellWidth&&e.cellWidth!==t.cellWidth&&(t.cellWidth=e.cellWidth,o=!0),"number"==typeof e.minCellWidth&&0<=e.minCellWidth&&e.minCellWidth!==t.minCellWidth&&(t.minCellWidth=e.minCellWidth,n=!0),void 0!==e.centerLatitude&&e.centerLatitude!==t.centerLatitude&&(t.centerLatitude=e.centerLatitude,o=!0),e.distanceUnits&&e.distanceUnits!==t.distanceUnits&&(t.distanceUnits=e.distanceUnits,o=!0),e.gridType&&e.gridType!==t.gridType&&(i=["square","circle"],-1<(a=["hexagon","hexCircle"]).indexOf(t.gridType)&&-1<a.indexOf(e.gridType)||-1<i.indexOf(t.gridType)&&-1<i.indexOf(e.gridType)?n=!0:o=!0,t.gridType=e.gridType),void 0!==e.aggregateProperties&&(t.aggregateProperties=e.aggregateProperties,o=!0),void 0!==e.scaleExpression&&e.scaleExpression!==t.scaleExpression&&(t.scaleExpression=e.scaleExpression,e.scaleProperty||t.scaleProperty)&&(n=!0),void 0!==e.scaleProperty&&e.scaleProperty!==t.scaleProperty&&(t.scaleProperty=e.scaleProperty,null===e.scaleProperty||"point_count"===e.scaleProperty?n=!0:o=!0),void 0!==e.coverage&&e.coverage!==t.coverage&&(t.coverage=e.coverage,n=!0),0<Object.keys(r).length&&L.prototype.setOptions.call(this,r),o||!this._gridInfo?this._recalculate():n&&this._recalculateCoords())},W.prototype.setPoints=function(e){this._points=[],this._pixels=[],this._addPoints(e),this._recalculate()},W.prototype._addPoints=function(e){var t,r=this._points,n=this._pixels,o=this._normalizeGetPixel22;if("FeatureCollection"===e.type&&(e=e.features),Array.isArray(e))for(var i=0,a=e.length;i<a;i++)this._addPoints(e[i]);else e instanceof v.Shape?"Point"===e.getType()&&(n.push(o(e.getCoordinates())),r.push(e.toJson())):"Feature"===e.type&&"Point"===e.geometry.type?(t=e,n.push(o(t.geometry.coordinates)),r.push(t)):"Point"===e.type&&(t=e,n.push(o(t.coordinates)),r.push(new v.data.Feature(t)))},W.prototype._normalizeGetPixel22=function(e){return e[0]=v.math.normalizeLongitude(e[0]),e[1]=v.math.normalizeLatitude(e[1]),A.toPixel22(e)},W.prototype._remove=function(e){var t,r=this,n=r._points;if(Array.isArray(e))for(var o=0,i=e.length;o<i;o++)r._remove(e[o]);else if(e instanceof v.Shape){for(var a=e.getId(),o=0,i=n.length;o<i;o++)if(n[o].id===a){r._remove(o);break}}else if("number"==typeof e)e<n.length&&n.splice(e,1);else if("string"==typeof e){for(o=0,i=n.length;o<i;o++)if(n[o].id===e){r._remove(o);break}}else"Feature"===e.type&&(t=n.indexOf(e),r._remove(t))},W.prototype._recalculate=function(){var e=this;void 0===this._requestId&&(e._requestId=requestAnimationFrame(function(){e._gridInfo=A.calculateGrid(e._points,e._pixels,e._options),e._updateCells(),e._requestId=void 0}))},W.prototype._recalculateCoords=function(){A.recalculateCoords(this._gridInfo,this._options),this._updateCells()},W.prototype._updateCells=function(){L.prototype._clearNoUpdate.call(this),L.prototype.add.call(this,this._gridInfo.cells)};var L,E,s=W;function N(){this.constructor=E}function W(e,t){e=L.call(this,e)||this;return e._options={maxZoom:18,cellWidth:25e3,minCellWidth:0,distanceUnits:"meters",gridType:"hexagon",coverage:1,centerLatitude:0},e._points=[],e._pixels=[],t&&(Object.assign(e._options,t),L.prototype.setOptions.call(e,Object.assign({buffer:8,tolerance:0},t))),e}o=Object.freeze({__proto__:null,GriddedDataSource:s}),(s=e.GridType||(e.GridType={})).circle="circle",s.hexagon="hexagon",s.hexCircle="hexCircle",s.pointyHexagon="pointyHexagon",s.square="square",s.triangle="triangle",s=G.merge("atlas.source",o),e.source=s})(this.atlas=this.atlas||{},atlas);
